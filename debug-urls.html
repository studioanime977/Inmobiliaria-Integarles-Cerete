// Script para verificar URLs en el navegador
// Copia y pega este cÃ³digo en la consola del navegador (F12)

console.log('ğŸ” VERIFICACIÃ“N DE URLs EN NAVEGADOR');
console.log('â•'.repeat(50));

// Verificar la URL base actual
console.log('ğŸŒ URL BASE ACTUAL:');
console.log('window.location.origin:', window.location.origin);
console.log('window.location.href:', window.location.href);
console.log('window.location.protocol:', window.location.protocol);
console.log('');

// FunciÃ³n buildAbsUrl del cÃ³digo actual
function buildAbsUrl(path){
  try {
    // Si ya es una URL completa, devolverla tal cual
    if (path.startsWith('http://') || path.startsWith('https://')) {
      return path;
    }

    // Construir URL basada en el entorno actual
    const baseUrl = window.location.origin;

    // Si el path ya incluye assets/img/, usarlo directamente
    if (path.startsWith('assets/')) {
      return baseUrl + '/' + path;
    }

    // Si no, agregar el prefijo assets/img/
    return baseUrl + '/assets/img/' + path;
  } catch(e) {
    console.error('Error construyendo la URL absoluta:', e);
    // Como fallback, intentar construir una URL relativa simple
    return new URL(path, window.location.href).href;
  }
}

// FunciÃ³n buildWhatsAppText del cÃ³digo actual
function buildWhatsAppText(title, category, path, info, price){
  const kind = category === 'locales' ? 'local comercial' : 'vivienda';
  const url = buildAbsUrl(path);

  let priceText = '';
  if(price && typeof price === 'number'){
    priceText = `\nğŸ’° Precio: $${price.toLocaleString('es-CO')}`;
  }

  const message = `Â¡Hola! ğŸ‘‹

Me interesa esta propiedad que vi en su pÃ¡gina web:

ğŸ  *${title}*
ğŸ“ Tipo: ${kind.charAt(0).toUpperCase() + kind.slice(1)}${priceText}

ğŸ”— Ver detalles completos:
${url}

Â¿PodrÃ­an darme mÃ¡s informaciÃ³n sobre disponibilidad y condiciones de arriendo?

Â¡Gracias!`;

  return message;
}

// FunciÃ³n para codificar mensaje de WhatsApp
function encodeWhatsAppMessage(message) {
  return message.replace(/\n/g, '%0A').replace(/\s+/g, '%20');
}

// Probar con datos reales del content-index.json
console.log('ğŸ§ª PRUEBA CON DATOS REALES:');
console.log('â”€'.repeat(50));

const testPaths = [
  "assets/img/VIVIENDAS/orilla-del-rio-centro/index.html",
  "assets/img/LOCALES/barrio-santa-teresa/index.html",
  "assets/img/VIVIENDAS/barrio-santa-clara/index.html"
];

testPaths.forEach((path, index) => {
  console.log(`\nğŸ“ PRUEBA ${index + 1}: ${path}`);

  const url = buildAbsUrl(path);
  console.log(`ğŸ”— URL GENERADA: ${url}`);

  const hasPercent20 = url.includes('%20');
  console.log(`âŒ CONTIENE %20: ${hasPercent20 ? 'SÃ (PROBLEMA)' : 'NO (CORRECTO)'}`);

  // Probar el mensaje completo de WhatsApp
  const whatsappMessage = buildWhatsAppText(
    `Propiedad-${index + 1}`,
    'viviendas',
    path,
    'DescripciÃ³n de prueba',
    500000
  );

  const whatsappEncoded = encodeWhatsAppMessage(whatsappMessage);
  const whatsappUrl = `https://wa.me/573015717622?text=${whatsappEncoded}`;

  console.log(`ğŸ“± URL WHATSAPP: ${whatsappUrl}`);
  console.log(`ğŸ“± CONTIENE %20: ${whatsappUrl.includes('%20') ? 'SÃ (PROBLEMA)' : 'NO (CORRECTO)'}`);

  console.log('\nğŸ“ MENSAJE COMPLETO:');
  console.log(whatsappMessage);
  console.log('');
});

console.log('ğŸ¯ INSTRUCCIONES PARA DEPURAR:');
console.log('1. Abre el chatbot en la pÃ¡gina');
console.log('2. Busca una propiedad (ej: "orilla")');
console.log('3. Haz clic en "ğŸ’¬ Consultar por WhatsApp"');
console.log('4. Revisa la consola (F12) para ver los logs');
console.log('5. Verifica que la URL no contenga %20');
